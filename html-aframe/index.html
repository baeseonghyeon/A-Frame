<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>A-Frame</title>
 
  <script src="https://cdn.jsdelivr.net/npm/aframe@1.2.0/dist/aframe-master.min.js"></script>  
  <script src="https://mixedreality.mozilla.org/ammo.js/builds/ammo.wasm.js"></script>
  <script src="//cdn.jsdelivr.net/gh/n5ro/aframe-physics-system@v4.0.1/dist/aframe-physics-system.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>


  <!-- Create Many Ball -->
  <script>
    let createSphere = () => {
    scene = document.querySelector("#cam");

      for (let i = 0; i < 20; i++) {
        const sphere = document.createElement('a-sphere');
        const x = (Math.random() - 0.5) * 1.5;
        const y = Math.random() + 1;
        const z = ((Math.random() - 0.5) * 1.5) - 4;
        sphere.setAttribute('position', '' + x + ' ' + y + ' ' + z);
        sphere.setAttribute('radius', 0.25);
        sphere.setAttribute('ammo-body', 'type: dynamic');
        sphere.setAttribute('ammo-shape', 'type: sphere');
        sphere.setAttribute('shadow', '');
        sphere.setAttribute('color', '#EF2D5E');
        scene.appendChild(sphere);
      }
    }
    window.addEventListener('click', createSphere);
  </script>

  <!-- Camera Physics -->
  <script>
    AFRAME.registerComponent('collision-wire', {
      schema: {
        element: {type: 'string'}
      },
      init: function() {
        let el = this.el;
        let element = this.data.element;

        el.addEventListener("collidestart", function (event) {
          if ( event.detail.targetEl.id === element) {
            el.setAttribute('material', {'wireframe': true});
          };
        });
        el.addEventListener("collideend", function (event) {
          if ( event.detail.targetEl.id === element) {
            el.setAttribute('material', {'wireframe': false});
          };
        });
      }
    });  
  </script>

  <!-- Cursor Event -->
  <script>
    AFRAME.registerComponent("event-listener", {
      init: function() {
        this.el.addEventListener("click", function(e) {
          console.log(e.target)
          e.target.setAttribute('scale', {x: 1.2, y: 1.2, z: 1.2});
          });
        this.el.addEventListener("mouseenter", function(e) {
          console.log(e.target)
          e.target.setAttribute('scale', {x: 1.1, y: 1.1, z: 1.1});
          });
        this.el.addEventListener("mouseleave", function(e) {
          console.log(e.target)
          e.target.setAttribute('scale', {x: 1, y: 1, z: 1});
          });
        }
      });
  </script>
</head>

<body>
  <a-scene physics="driver: ammo; debugDrawMode: 1;" stats>

    <!-- Assets -->
    <a-assets>
      <!-- Texture -->
      <img id="sample" src="assets/texture/sample.jpg">
      <img id="sample-NRM" src="assets/texture/sample-NRM.jpg">
      <img id="bricks" src="assets/texture/bricks.jpg">
      <img id="bricks-NRM" src="assets/texture/bricks-NRM.jpg">

      <!-- 3D Model -->
      <a-asset-item id="bb8" src="assets/model/bb8/scene.gltf"></a-asset-item>
    </a-assets>

    <!-- Object -->
    <a-cylinder 
      event-listener
      ammo-body="type: dynamic"
      ammo-shape="type: cylinder"
      position="2 3 -3"
      material="opacity: 0;"
      geometry="height: 1.25; radius: 0.5;"
    >
      <a-entity 
        gltf-model="#bb8"
        position="0 0.2 0"
        scale="0.01 0.01 0.01"
        animation="property: rotation; dur: 10000; dir: normal; loop: true; to: 0 360 0"
        shadow
      >
      </a-entity>
    </a-cylinder>

    <a-box event-listener ammo-body="type: dynamic" ammo-shape="type: box" position="-1 3 -3" rotation="0 45 0" color="#4CC3D9" shadow></a-box>
    <a-sphere event-listener ammo-body="type: dynamic" ammo-shape="type: sphere" position="0 3 -5" radius="1.25" color="#EF2D5E" shadow></a-sphere>
    <a-cylinder event-listener ammo-body="type: dynamic" ammo-shape="type: cylinder" position="1 3 -3" radius="0.5" height="1.5" color="#FFC65D" shadow></a-cylinder>

    <!-- Wall -->
    <a-box
      ammo-body="type: static"
      ammo-shape="type: box"
      color="#FFFFFF"
      src="#sample"
      repeat="1 1"
      normal-map="#sample-NRM"
      normal-texture-repeat="1 1"
      normal-scale="1 -1"
      roughness="0.5"
      width="8" height="8" depth="0.5"
      position="0 4 -8"
      scale="-1 1 1"
      shadoww
    >
    </a-box>
    <a-box
      ammo-body="type: static"
      ammo-shape="type: box" 
      color="#FFFFFF"
      src="#bricks"
      repeat="1 1"
      normal-map="#bricks-NRM"
      normal-texture-repeat="1 1"
      normal-scale="1 -1"
      roughness="0.9"
      width="8" height="4" depth="0.5"
      position="4 2 -4"
      rotation="0 90 0"
      scale="-1 1 1"
      shadow
    ></a-box>

    <!-- Environment -->
    <!-- <a-light type="ambient" color="white"></a-light> -->
    <!-- <a-light type="point" intensity="1" position="-2 2 2"></a-light> -->
    <a-plane ammo-body="type: static" ammo-shape="type: box" position="0 0 -4" rotation="-90 0 0" width="15" height="15" color="#7BC8A4" shadow ></a-plane>
    <a-sky color="#ECECEC"></a-sky>

    <!-- Camera rig, with a cylynder to give an idea of its "size"-->
    <a-entity 
      movement-controls="fly: false" position="0 0 5"
      geometry="primitive: cylinder; height: 2; radius: 0.5"
      material="opacity: 0; wireframe: true"
      id="cam" ammo-body="type: kinematic;" ammo-shape="type: cylinder">
      <a-entity camera position="0 1.6 0" look-controls></a-entity>
      <a-entity cursor="rayOrigin:mouse" ></a-entity>
      <a-entity laser-controls="hand: right"></a-entity>
    </a-entity>
  </a-scene>
</body>
</html>